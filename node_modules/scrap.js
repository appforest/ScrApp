scrApp ={
	findItem:function(scrapData){
		var request = require("request"),
		 	cheerio = require("cheerio"),
		 	items = [];
		setInterval(function searchItems(){
				request(scrapData.url, function (err, resp, body){
					if(!err && resp.statusCode == 200){
						var $ = cheerio.load(body);
		            	$(scrapData.targetElem, scrapData.containingElem).each(function(){
			            var price = $(".priceLarge" ).text().slice(1,this.text().length),
			            	name = $("#btAsinTitle").text();

								items.push(price);
								var currentPrice = items[items.length-1],
									lastPrice = items[items.length-2];

								console.log(name+": $"+currentPrice);
						// The email
						function emailMe(){
							var nodemailer = require("nodemailer");
							var smtpTransport = nodemailer.createTransport("SMTP",{
								service: "Gmail",
								auth: {
									user: scrapData.sentinelEmail,
									pass: scrapData.sentinelPass
								}
							});
							var mailOptions = {
							    from: "Your item's price has dropped! <"+scrapData.sentinelEmail+">",
							    to: scrapData.targetEmail,
							    subject: "Check "+name+" new price!",
							    html: "<h1><b>Check out your product <em>"+name+"</em></b></h1><br />Visit <a href='"+scrapData.url+"'>"+scrapData.url+"</a><br /><hr /><a href='https://github.com/appforest/ScrApp/'>Sent by scrApp, by Diego Coy</a>"
							}
							smtpTransport.close();
							smtpTransport.sendMail(mailOptions, function(error, response){
								if(error){
									console.log(error);
								}else{
									console.log("Message sent: " + response.message);
								}
							   // smtpTransport.close(); // shut down the connection pool, no more messages
							});
							//--- /The email
						} //--- /emailMe
						if(currentPrice<lastPrice){
							console.log("Lower price found: $"+currentPrice+". Notifying by email...");
							emailMe();
						}
					});
				}
			});
		}, scrapData.timeFrame);
	}
}